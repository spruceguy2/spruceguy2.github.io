<!doctype html>
<html>
  <head>
    <link href="style.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <title>MetroBuild</title>
  </head>
  <body>
    <h1>MetroBuild 0.2</h1>
    By SpruceGuy
    <div id="map"></div>
    <button class="line" id="cyan">C</button>
    <button class="line" id="yellow">Y</button>
    <script>
      
      
      
      
      var index = -1
      var map = L.map('map').setView([40.75, -73.98], 13);
      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(map);
      var y = {name:"y", dname:"y", color:"#ffff00", tcolor:"#000000", stations:[], markers:[], coords:[], line:L.polyline([], {color: '#ffff00', weight:6}).addTo(map)}
      var c = {name:"c", dname:"c", color:"#00ffff", tcolor:"#000000", stations:[], markers:[], coords:[], line:L.polyline([], {color: '#00ffff', weight:6}).addTo(map)}
      var ctrain = y
      
      var stations = []
      var markers = []
      class Station{
        constructor(name,lat,lng){
          this.name=name
          this.lat=lat
          this.lng=lng
          //add later
        }
      }
      map.on('click', function(e){
        var k = prompt("What do you want your station to be called?")
        stations.push(new Station(k,e.latlng.lat,e.latlng.lng))
        markers.push(L.marker([e.latlng.lat, e.latlng.lng]).addTo(map))
        
        index++
        markers[index].bindPopup(k)
        for(let i of stations){
          if(Math.abs(e.latlng.lat - i.lat)<=0.01){
            markers[stations.indexOf(i)].openPopup()
          }
          if(Math.abs(e.latlng.lng - i.lng)<=0.01){
            markers[stations.indexOf(i)].openPopup()
          }
        }
        
        
        ctrain.markers.push(markers[index])
        ctrain.stations.push(stations[index])
        ctrain.coords=[]
        for( i of ctrain.stations){
          ctrain.coords.push([i.lat, i.lng])
        }
        ctrain.line.setLatLngs(ctrain.coords)
      })
      $("#cyan").click(function(){
        ctrain = c
      })
      $("#yellow").click(function(){
        ctrain = y
      })
    </script>
  </body>
</html>
